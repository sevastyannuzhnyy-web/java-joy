# Java Joy Cafeteria

A Vite + React + TypeScript single-page app for the Java Joy school cafeteria. Customers can browse the menu, choose delivery or pickup, select a payment method, and place an order that is stored in Supabase with idempotent writes and device-scoped order history.

## Quick Start

1. Install dependencies:
   ```bash
   npm install
   ```
2. Copy `.env.example` to `.env.local` and fill in your Supabase project credentials (see below).
3. Run the development server:
   ```bash
   npm run dev
   ```
4. Open the printed URL (default http://localhost:5173) in your browser.

## Environment Variables

Create `.env.local` with the following values:

```
VITE_SUPABASE_URL=<your-supabase-url>
VITE_SUPABASE_ANON_KEY=<your-supabase-anon-key>
```

No secrets are committed to the repository; keep `.env.local` out of version control.

## Supabase Setup

Ensure the `orders` table exists with row-level security policies that allow inserts and selects for this demo:

```sql
create table if not exists public.orders (
  id bigint generated by default as identity primary key,
  device_id text,
  items jsonb,
  total numeric,
  payment_method text,
  status text default 'pending',
  idempotency_key text unique,
  created_at timestamptz default now()
);

alter table public.orders enable row level security;
drop policy if exists allow_insert_all on public.orders;
drop policy if exists allow_select_all on public.orders;
create policy allow_insert_all on public.orders for insert with check (true);
create policy allow_select_all on public.orders for select using (true);
create unique index if not exists orders_idem_key_idx on public.orders (idempotency_key);
```

## Available Scripts

- `npm run dev` – start the dev server.
- `npm run build` – create a production build in `dist/`.
- `npm run preview` – preview the production build locally.

## Deploying to Vercel

1. Create a new Vercel project from this repository.
2. In the project settings, add environment variables:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
3. Set the build command to `npm run build` and the output directory to `dist`.
4. Trigger a deployment; Vercel will provide the live URL once the build succeeds.

## Deploying to Netlify

1. Create a new site from your Git repository.
2. In Site settings → Environment variables, add:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
3. Use `npm run build` as the build command and `dist` as the publish directory.
4. Deploy the site. Netlify will host the compiled application.

## Order Flow Highlights

- The frontend generates a per-device id and stores orders through Supabase using an idempotent `upsert` on `idempotency_key` to avoid duplicates.
- Order numbers come directly from the database (`orders.id`) and are surfaced in the UI after a successful submission.
- Recent orders for the current device are cached in `localStorage` (`orders_v1`) and visible via the order history modal.
